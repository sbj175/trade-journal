<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Display Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-slate-900 text-white p-8">
    <div x-data="testData()">
        <h1 class="text-2xl font-bold mb-4">Transaction Display Test</h1>
        
        <div class="bg-slate-800 rounded-lg p-4">
            <h2 class="text-lg font-semibold mb-3">NFLX Bear Call Spread - Closed</h2>
            
            <!-- Option Legs Details -->
            <div class="mt-3">
                <div class="text-xs font-medium text-slate-400 mb-2">Option Legs</div>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead>
                            <tr class="text-slate-500 border-b border-slate-700">
                                <th class="text-left py-1 px-2 font-medium">Action</th>
                                <th class="text-left py-1 px-2 font-medium">Qty</th>
                                <th class="text-left py-1 px-2 font-medium">Exp</th>
                                <th class="text-left py-1 px-2 font-medium">Strike</th>
                                <th class="text-left py-1 px-2 font-medium">Type</th>
                                <th class="text-left py-1 px-2 font-medium">Price</th>
                                <th class="text-left py-1 px-2 font-medium">Date/Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="leg in trade.option_legs" :key="leg.id">
                                <template x-for="(action, actionIndex) in (leg.transaction_actions || [])" :key="leg.id + '_' + actionIndex">
                                    <tr class="border-b border-slate-800/50">
                                        <td class="py-1 px-2">
                                            <span class="inline-block bg-blue-900/30 text-blue-300 px-1 py-0.5 rounded text-xs font-medium"
                                                  x-text="action"></span>
                                            <!-- Closing Type Emblems -->
                                            <span x-show="action.includes('BTC')" class="ml-1 text-blue-400" title="Bought to Close">ðŸ”µ</span>
                                            <span x-show="action.includes('STC')" class="ml-1 text-purple-400" title="Sold to Close">ðŸŸ£</span>
                                        </td>
                                        <td class="py-1 px-2 font-mono text-slate-300"
                                            x-text="(leg.quantity >= 0 ? '+' : '') + leg.quantity"></td>
                                        <td class="py-1 px-2 text-slate-300"
                                            x-text="formatDate(leg.expiration)"></td>
                                        <td class="py-1 px-2 font-mono text-slate-300"
                                            x-text="'$' + leg.strike"></td>
                                        <td class="py-1 px-2 text-slate-300"
                                            x-text="leg.option_type.charAt(0)"></td>
                                        <td class="py-1 px-2 font-mono text-slate-300">
                                            <span x-text="'$' + ((['BTO', 'STO'].includes(action)) ? leg.entry_price : leg.exit_price || '0.00')"></span>
                                        </td>
                                        <td class="py-1 px-2 text-slate-400 text-xs">
                                            <span x-show="leg.transaction_timestamps && leg.transaction_timestamps[actionIndex]"
                                                  x-text="leg.transaction_timestamps[actionIndex] ? new Date(leg.transaction_timestamps[actionIndex]).toLocaleString('en-US', {
                                                      month: 'short', 
                                                      day: 'numeric', 
                                                      hour: '2-digit', 
                                                      minute: '2-digit'
                                                  }) : 'N/A'"></span>
                                            <span x-show="!leg.transaction_timestamps || !leg.transaction_timestamps[actionIndex]" class="text-slate-500">N/A</span>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function testData() {
            return {
                trade: {
                    trade_id: "NFLX_20250505_4legs_644",
                    underlying: "NFLX",
                    strategy_type: "Bear Call Spread",
                    option_legs: [
                        {
                            id: 17192,
                            symbol: "NFLX  250606C01185000",
                            underlying: "NFLX",
                            option_type: "Call",
                            strike: 1185.0,
                            expiration: "2025-06-06",
                            quantity: -1,
                            entry_price: 28.55,
                            exit_price: 31.95,
                            transaction_actions: ["STO", "BTC"],
                            transaction_timestamps: ["2025-05-05T19:42:48.059000+00:00", "2025-05-20T13:39:44.518000+00:00"]
                        },
                        {
                            id: 17193,
                            symbol: "NFLX  250606C01190000", 
                            underlying: "NFLX",
                            option_type: "Call",
                            strike: 1190.0,
                            expiration: "2025-06-06",
                            quantity: 1,
                            entry_price: 26.75,
                            exit_price: 29.45,
                            transaction_actions: ["BTO", "STC"],
                            transaction_timestamps: ["2025-05-05T19:42:48.059000+00:00", "2025-05-20T13:39:44.518000+00:00"]
                        }
                    ]
                },
                
                formatDate(dateStr) {
                    if (!dateStr) return '';
                    const parts = dateStr.split('-');
                    if (parts.length === 3) {
                        const date = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    }
                    return dateStr;
                }
            }
        }
    </script>
</body>
</html>